---
title: "AsssignmentReport"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction
Since the significance of the knowledge about the edibility of mushroom, we believe it's necessary to extract meaningful infomation from the mushrooom dataset.This data set includes descriptions of hypothetical samples corresponding to 23 species of gilled mushrooms in the Agaricus and Lepiota Family.Each species is identified as edible or poisonous.This report mainly focus on the analysis of Mushroom dataset, including some static analysis in data exploration part, and association rules mining in data analysis part. 

## Data Exploration
Load the dataset at first.
```{r}
##load Mushroom dataset
url <- "./data/mushroom/agaricus-lepiota.data"
mushrooms <- read.csv(file = url, header = FALSE)
#assign column names
names(mushrooms) <- c("class", "cap-shape", "cap-surface",
                      "cap-color", "bruises", "odor", "gill-attachment", "gill-spacing",
                      "gill-size", "gill-color", "stalk-shape", "stalk-root",
                      "stalk-surface-above-ring", "stalk-surface-below-ring",
                      "stalk-color-above-ring", "stalk-color-below-ring",
                      "veil-type", "veil-color", "ring-number", "ring-type",
                      "spore-print-color", "population", "habitat")
```

Then check out the dimensionality of the dataset.There is 8124 samples and 23 features.
```{r}
dim(mushrooms)
```

And its column names.
```{r}
names(mushrooms)
```

We can further explore these colunms.The first colunm indicates the edibility of the species.The remaining column is about various features of the species which covers different part of the mushroom from the cap to the root, and also describe the characteristics of the mushroom from different sensory levels, including vision, smell, touch, etc.Note that all the columns are factors.
```{r}
str(mushrooms)
```

In order to know the split of between edible mushrooms and poisonous ones in the dataset, we can plot a pie chart, from which we can see the dataset is quite balanced.
```{r fig.height=2.5, fig.width=2.5, message=FALSE, warning=FALSE, paged.print=FALSE}
library(dplyr)
tab <- mushrooms$class %>% table()
precentages <- tab %>% prop.table() %>% round(3) * 100
txt <- paste0(names(tab), '\n', precentages, '%')
pie(tab, labels=txt)
```

## Data Analysis:Association Rules Mining
Now we use Apriori to mine association rules.note that we limit the length to [2,5],and confidence=1 to filter out over complex rules and less reliable ones.And we can print the number of rules we get.
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(arules)
library(arulesViz)
rules <- apriori(mushrooms, control = list(verbose=F),
                 parameter = list(minlen=2, maxlen=5, confidence=1),
                 appearance = list(rhs=c("class=p", "class=e"),
                                   default="lhs"))
quality(rules) <- round(quality(rules), digits=3)
paste('The numer of rules we got is',nrow(quality(rules)))
```
Before analysis, prune the redundant rules.
## Conclusion
```{r}
#prune redundant rules
subset.matrix <- is.subset(rules, rules)
subset.matrix[lower.tri(subset.matrix, diag=T)] <- F
redundant <- colSums(subset.matrix) >= 1
rules.pruned <- rules[!redundant]
#check out how many rules left after pruning
paste("The number of rules left after pruning is",nrow(quality(rules.pruned)))
```
Now we can inspect the first 8 rules after sorting the rules by lift and support. 
```{r}
#Sort rules by lift and support and inspect the first 8 ones.
rules.pruned.sorted <- sort(rules.pruned, by=c("lift","support"))
inspect(head(rules.pruned.sorted, 8))
```
And by using a scatter plot we can visualize the distribution of the rules.
```{r}
plot(rules.pruned.sorted, measure=c("support","lift"))
```
In order to further analyse the association between these 8 rules, we can visualize them by ploting a graph.
```{r fig.height=6, fig.width=6}
#plot the graph of the rules to the association between them
head(rules.pruned.sorted,n=8) %>% plot(method="graph",  control=list(layout=igraph::in_circle()))
```
